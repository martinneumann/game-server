<header></header>

<body>
    <canvas id="game" width="100%" height="100%">

    </canvas>
    <script src="/socket.io/socket.io.js"></script>
    <script>

        class Pose {
            x;
            y;
            w;  // orientation in whatever unit game maker provides
            constructor(x, y, w) {
                this.x = x;
                this.w = w;
                this.y = y;
            }
        }

        var diffPose = new Pose(0, 0, 0);
        var socket = io();

        var canvas = document.getElementById('game');
        var ctx = canvas.getContext("2d");

        window.addEventListener('keydown', function (e) {
            e.preventDefault();
            diffPose.x = 0;
            diffPose.y = 0;
            switch (event.key) {
                case 'w':
                case 'W':
                    diffPose.y = -10;
                    break;
                case 'a':
                case 'A':
                    diffPose.x = -10;
                    break;
                case 's':
                case 'S':
                    diffPose.y = 10;
                    break;
                case 'd':
                case 'D':
                    diffPose.x = 10;
                    break;
                default:
                    break;
            }
            if (event.key) {
                socket.emit('keypressed', diffPose);
                event.key = '';
            }
        });

        // New user connects.
        socket.on('newuser', (userid) => {
            console.log(`New user ${userid} connected.`);
            //ctx.beginPath();
            ctx.fillRect(100, 100, 40, 40);
            //ctx.fill();
        });

        // General key press or movement or whatever.
        socket.on('movement', function (msg) {
            ctx.clearRect(0,0,canvas.width, canvas.height);
            for (var player in msg) {
                ctx.fillStyle = msg[player]["color"];
                ctx.fillRect(msg[player]["pose"]["x"], msg[player]["pose"]["y"], 40, 40);
            }
        });
    </script>
</body>